<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wikipedia Path Finder</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="main-container">
        <h1 class="main-title">Welcome to Wikipedia Path Finder</h1>
        
        <div class="searchers-container">
            <!-- DFS Searcher Box -->
            <div class="search-box dfs-box">
                <h2 class="box-header">DFS Searcher</h2>
                <form method="post">
                    <div class="input-group">
                        <input type="text" id="dfs_start" name="dfs_start" placeholder="Start Point" required>
                        <span class="arrow">➟</span>
                        <input type="text" id="dfs_end" name="dfs_end" placeholder="End Point" required>
                        <button type="submit" name="dfs_submit">Go!</button>
                    </div>
                    {% if dfs_result %}
                        <p class="result">{{ dfs_result }}</p>
                    {% endif %}
                </form>
            </div>

            <!-- BFS Searcher Box -->
            <div class="search-box bfs-box">
                <h2 class="box-header">BFS Searcher</h2>
                <form method="post">
                    <div class="input-group">
                        <input type="text" id="bfs_start" name="bfs_start" placeholder="Start Point" required>
                        <span class="arrow">➟</span>
                        <input type="text" id="bfs_end" name="bfs_end" placeholder="End Point" required>
                        <button type="submit" name="bfs_submit">Go!</button>
                    </div>
                    {% if bfs_result %}
                        <p class="result">{{ bfs_result }}</p>
                    {% endif %}
                </form>
            </div>
        </div>
    </div>

    <script>
        // Ensure the links are rendered properly as a JavaScript array
        const links = JSON.parse('{{ links | tojson | safe }}');  // Get the links from the backend and parse it into a JS array
        
        // Autocomplete for start and end inputs (DFS and BFS)
        function autocomplete(input, data) {
            let currentFocus;
            input.addEventListener("input", function() {
                let list, listItem, val = this.value;
                closeAllLists();
                if (!val) return false;
                currentFocus = -1;
                list = document.createElement("DIV");
                list.setAttribute("id", this.id + "autocomplete-list");
                list.setAttribute("class", "autocomplete-items");
                this.parentNode.appendChild(list);
                
                for (let i = 0; i < data.length; i++) {
                    if (data[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
                        listItem = document.createElement("DIV");
                        listItem.innerHTML = "<strong>" + data[i].substr(0, val.length) + "</strong>";
                        listItem.innerHTML += data[i].substr(val.length);
                        listItem.addEventListener("click", function() {
                            input.value = data[i];
                            closeAllLists();
                        });
                        list.appendChild(listItem);
                    }
                }
            });
            
            // move in dropdown menu 
            input.addEventListener("keydown", function(e) {
                let list = document.getElementById(this.id + "autocomplete-list");
                if (list) list = list.getElementsByTagName("div");
                if (e.keyCode == 40) { // Down key
                    currentFocus++;
                    addActive(list);
                } else if (e.keyCode == 38) { // Up key
                    currentFocus--;
                    addActive(list);
                } else if (e.keyCode == 13) { // Enter key
                    e.preventDefault();
                    if (currentFocus > -1) {
                        if (list) list[currentFocus].click();
                    }
                }
            });
    
            function addActive(list) {
                if (!list) return false;
                removeActive(list);
                if (currentFocus >= list.length) currentFocus = 0;
                if (currentFocus < 0) currentFocus = (list.length - 1);
                list[currentFocus].classList.add("autocomplete-active");
            }
    
            function removeActive(list) {
                for (let i = 0; i < list.length; i++) {
                    list[i].classList.remove("autocomplete-active");
                }
            }
    
            function closeAllLists(elmnt) {
                let lists = document.getElementsByClassName("autocomplete-items");
                for (let i = 0; i < lists.length; i++) {
                    if (elmnt != lists[i] && elmnt != input) {
                        lists[i].parentNode.removeChild(lists[i]);
                    }
                }
            }
    
            document.addEventListener("click", function (e) {
                closeAllLists(e.target);
            });
        }
    
        // Initialize autocomplete on the input fields
        autocomplete(document.getElementById("dfs_start"), links);
        autocomplete(document.getElementById("dfs_end"), links);
        autocomplete(document.getElementById("bfs_start"), links);
        autocomplete(document.getElementById("bfs_end"), links);
    </script>
    
</body>
</html>
